---
title: "Consultant Expenditures and Fair Allocation in Toronto"
subtitle: "An assessment of Toronto's capital allocation"
author: 
  - Aman Rana
thanks: "Code and data are available at: LINK."
date: September 27 2024
date-format: long
abstract: "The Canadian federal government has been under scrutiny since the widely reported ArriveCAN scandal, which brought to light a severe misappropriation of funds through contractors. In light of these events, I investigate the allocation of funds to consultants by the City of Toronto. Exploring expenditure, I find an increasing budget allocation to consultants, and a tendency to allocate to a few key consultants. I suggest future work which could lead to a more complete evaluation and a possible investigation into the bidding process. "
format: pdf
number-sections: true
bibliography: references.bib
---

```{r}
#| include: false
#| warning: false
#| message: false

library(tidyverse)
library(ggplot2)
library(kableExtra)
options(warn = -1)


all_data <- read_csv(here::here("data/analysis_data/expenditure_analysis_data.csv"))
all_data$expenditure <- as.numeric(all_data$expenditure)
```


# Introduction
The CBSA (Canadian Border Security Agency) and Public Health Agency of Canada spent over $53 Million Dollars on an app which was created using 23 subcontractors. The contract process was unfair and non-competitive, with an internal report finding that the government criteria preferred one contractor over others @ArriveCANScandalFacts. The people of a city benefit from fair and efficient markets, as such the allocation of its tax dollars should follow a transparent and robust tender process.

In this paper we explore the City of Toronto's consultant expenditure data, sourced from @opendatatoronto.
We looked for any abnormal concentration of funds, or systematic patters that could suggest a biased tender process.
We use @citeR, @ggplot2, @kableExtra and @tidyverse in the process of my analysis, and arrive to a few simple conclusions.

Through illustrative plots, we find that consultant expenditure has been growing steadily over the last few years, across a variety of verticals. We then observe the data and notice that two consultants dominate expenditure; Deloitte and Ernst & Young. We then look at their allocation as a fraction of total yearly expenditure and observe their share of the City's expenditure to be growing over time. 

We consider a few possible driving factors and reccomend future work that could enable more robust conclusions on the competitive nature of the City's tender process.


The remainder of this paper is structured as follows:

@sec-data Walks through the Data collection and cleaning.
 
@sec-results Introduces a few plots which illustrate evidence of concentration.
 
@sec-discussion Discusses the possible driving processes for this concentration.
 
@sec-future-work Discusses possible future work that could lead to a more robust conclusion.

# Data {#sec-data}

I grab the data from @opendatatoronto, which returns excel workbooks for the years 2012-2016, 2022-2023, and 2017-2021. I then merge the data to a single large dataset to make it easier to manipulate, dropping to only the following columns: 

year - Year of the expenditure (2012-2023),

budget_type - Type of Budget which is Operating or Capital,

city_abc - City Specification,

expense_category - Type of Expenditure, IT/Transportation/Management etc.,

division_board - Which division of the City incurred the expense,

consultants_name - Consultant on the project,

description_of_the_work - Brief free-text explanation of the work,

expenditure - Dollar amount of the project,


We had to rename some columns to standardise the merge across the three different data files, and these details can be found in the repository. 

We now have the table @data-head.

Upon inspection, there are a few non-standardised naming schemes in the divison_board and expense_categories, 'operating' also exists as 'Operation' and a few spelling mistakes/variations in the Toronto Police Service's naming. To account for this, I manually standardise these naming schemes and sort through the dsata to make sure no large expenses are unaccounted for due to a spelling mistake or variation.

Here is a sample of the table

```{r}
#| label: data-head
#| fig-cap: Data Sample
#| echo: false

knitr::kable(head(all_data, 1), "latex", booktabs = TRUE, caption = "Data Sample") %>%
  kable_styling(latex_options = c("scale_down"), font_size = 11)
```

# Results {#sec-results}

The first establishing point we notice is that expenditure has been increasing year on year as seen in @yearly-cat-expenditure.

```{r}
#| label: yearly-cat-expenditure
#| fig-cap: Yearly Expenditure by Category
#| echo: false
         
# Expenditure by Category and Year
ggplot(all_data, aes(x = year, y = expenditure, fill = expense_category)) +
  geom_bar(stat = "identity", position = "stack") +
  labs(title = "Expenditure by Category and Year", x = "Year", y = "Expenditure") +
  theme_minimal()

# Aggregate expenditure by expense_category and get top 5 categories
top_categories <- all_data %>%
  group_by(expense_category) %>%
  summarise(total_expenditure = sum(expenditure, na.rm = TRUE)) %>%
  arrange(desc(total_expenditure)) %>%
  head(5)
```


We also see in the figure @top-consultants that Deloitte and Ernst and Yonge take the lion's share of the projects form the City.

```{r}
#| label: top-consultants
#| fig-cap: Expenditure by Consultant
#| echo: false

# Expenditure by Year
ggplot(all_data, aes(x = year, y = expenditure, fill = year)) +
  geom_bar(stat = "identity") +
  labs(title = "Total Expenditure by Year", x = "Year", y = "Expenditure") +
  theme_minimal()

# Aggregating expenditure by consultant and selecting the top 10
top_consultants <- all_data %>%
  group_by(consultants_name) %>%
  summarise(total_expenditure = sum(expenditure, na.rm = TRUE), .groups = 'drop') %>%
  arrange(desc(total_expenditure)) %>%
  head(10)

# Plotting top consultants
ggplot(top_consultants, aes(x = reorder(consultants_name, total_expenditure), y = total_expenditure)) +
  geom_bar(stat = "identity", fill = "skyblue") +
  coord_flip() +
  labs(title = "Top 10 Consultants by Total Expenditure", x = "Consultants", y = "Total Expenditure") +
  theme_minimal()
```

Finally, we plot their share over time, which is their yearly portion of the total consultant expenditure.

```{r}
#| label: increasing-share-proof
#| fig-cap: Increasing Share of Total Expenditure
#| echo: false
# Filter data for EY and Deloitte
filtered_consultants <- all_data %>%
  filter(consultants_name %in% c("Ernst & Young LLP", "Ernst & Young", "Deloitte LLP", "Deloitte"))

# Calculate total expenditure per year
total_expenditure_per_year <- all_data %>%
  group_by(year) %>%
  summarise(total_expenditure = sum(expenditure, na.rm = TRUE))

# Calculate EY and Deloitte's share of expenditure per year
consultant_share <- filtered_consultants %>%
  group_by(year, consultants_name) %>%
  summarise(consultant_expenditure = sum(expenditure, na.rm = TRUE)) %>%
  left_join(total_expenditure_per_year, by = "year") %>%
  mutate(share_percentage = consultant_expenditure / total_expenditure * 100)

# Plot for EY's share over time
ey_plot <- ggplot(consultant_share %>% filter(consultants_name %in% c("Ernst & Young LLP", "Ernst & Young")),
                  aes(x = year, y = share_percentage)) +
  geom_line(color = "blue", size = 1) +
  geom_point(color = "blue", size = 2) +
  labs(title = "EY's Share of Total Expenditure Over Time",
       x = "Year", y = "Share of Expenditure (%)") +
  theme_minimal()

# Plot for Deloitte's share over time
deloitte_plot <- ggplot(consultant_share %>% filter(consultants_name %in% c("Deloitte LLP", "Deloitte")),
                        aes(x = year, y = share_percentage)) +
  geom_line(color = "green", size = 1) +
  geom_point(color = "green", size = 2) +
  labs(title = "Deloitte's Share of Total Expenditure Over Time",
       x = "Year", y = "Share of Expenditure (%)") +
  theme_minimal()

# Print the two plots
print(ey_plot)
print(deloitte_plot)
```


# Discussion {#sec-discussion}

We find that Deloitte and EY have a growing share of the City of Toronto's capital allocation, and this is apart from the fact that the City's consultant budget has been increasing. Showing a proportional increase gives rise to questions of tender robustness and capital allocation. If this trend was to continue, Deloitte and EY would form a duopoly, taking more of the contracts, until they get bargaining power over the government. It may even be a sign of preferential treatment.

# Weaknesses and next steps {#sec-future-work}

The results I have shown are somewhat naive. The increasing share could be becuase of more competitive pricing as these larger more established firms get more sophisticated and are able to better price their contracts. They could also be follow-ups on prior contract, leading to a cumulative effect of greater allocation. Further work would involve looking at these trends across industries, and seeing where any outliers in expenditure exist, if there are smaller firms taking on a few high paying contracts, those might be better examples of preferential treatment. However, the data is sound and the results do still show a proportional increase in expenditure, and an investigation into the tender procedure could be warranted shoudl the future work show more systematic abnormal allocation.

\newpage

\newpage


# References


