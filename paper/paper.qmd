---
title: "Consultant Expenditures and Fair Allocation in Toronto"
subtitle: "An assessment of Toronto's capital allocation"
author: 
  - Aman Rana
thanks: "Code and data are available at: LINK."
date: September 27 2024
date-format: long
abstract: "The Canadian federal government has been under scrutiny since the widely reported ArriveCAN scandal, which brought to light a sever misappropriation of funds through contractors. In light of these events, I investigate the allocation of funds to consultants by the City of Toronto. Exploring expenditure, I find an increasing budget allocation to consultants, and a tendency to allocate to a few key consultants. I suggest future work which could lead to a more complete evaluation and a possible investigation into the bidding process. "
format: pdf
number-sections: true
bibliography: references.bib
---

```{r}
#| include: false
#| warning: false
#| message: false

library(tidyverse)
library(palmerpenguins)
```


# Introduction
The CBSA (Canadian Border Security Agency) and Public Health Agency of Canada spent over $53 Million Dollars on an app which was created using 23 subcontractors. The contract process was unfair and non-competitive, with an internal report finding that the government criteria preferred one contractor over others @ArriveCANScandalFacts. The people of a city benefit from fair and efficient markets, as such the allocation of its tax dollars should follow a transparent and robust tender process.

In this paper I explored the City of Toronto's consultant expenditure data, sourced from @opendatatoronto.
I looked for any abnormal concentration of funds, or systematic patters that could suggest a biased tender process.
I use @citeR and @rohan in the process of my analysis, and arrive to a few simple conclusions.

Through illustrative plots, we find that consultant expenditure has been growing steadily over the last few years, across a variety of verticals. 

The remainder of this paper is structured as follows:
 @sec-data Walks through the Data collection and cleaning.
 
 @sec-results Introduces a few plots which illustrate evidence of concentration.
 
 @sec-discussion Discusses the possible driving processes for this concentration.
 
 @sec-future-work Discusses possible future work that could lead to a more robust conclusion.

# Data {#sec-data}

I grab the data from @opendatatoronto, which returns excel's for the years 2012-2016, 2022-2023, and 2017-2021. I then merge the dtaa to a single large dataset to make it easier to manipulate, dropping to only the following columns: year, budget_type, city_abc, expense_category, division_board, consultants_name, description_of_the_work, expenditure. I had to rename some columns to standardise the merge across the three different data files, and these details can be found in the repository. 

```{r}
#| label: data-head
#| fig-cap: Data Sample
#| echo: false

all_data <- read_csv("~/Documents/STA304/Term_Paper_1/paper/expenditure_analysis_data.csv")
all_data$expenditure <- as.numeric(all_data$expenditure)
all_data.head(5)

```

```{r}
#| label: top-consultants
#| fig-cap: Expenditure by Consultant
#| echo: false


library(ggplot2)
all_data <- read_csv("~/Documents/STA304/Term_Paper_1/paper/expenditure_analysis_data.csv")
all_data$expenditure <- as.numeric(all_data$expenditure)

# Expenditure by Year
ggplot(all_data, aes(x = year, y = expenditure, fill = year)) +
  geom_bar(stat = "identity") +
  labs(title = "Total Expenditure by Year", x = "Year", y = "Expenditure") +
  theme_minimal()

# Aggregating expenditure by consultant and selecting the top 10
top_consultants <- all_data %>%
  group_by(consultants_name) %>%
  summarise(total_expenditure = sum(expenditure, na.rm = TRUE)) %>%
  arrange(desc(total_expenditure)) %>%
  head(10)

# Plotting top consultants
ggplot(top_consultants, aes(x = reorder(consultants_name, total_expenditure), y = total_expenditure)) +
  geom_bar(stat = "identity", fill = "skyblue") +
  coord_flip() +
  labs(title = "Top 10 Consultants by Total Expenditure", x = "Consultants", y = "Total Expenditure") +
  theme_minimal()
```
```{r}
#| label: yearly-cat-expenditure
#| fig-cap: Yearly Expenditure by Category
#| echo: false
         
# Expenditure by Category and Year
ggplot(all_data, aes(x = year, y = expenditure, fill = expense_category)) +
  geom_bar(stat = "identity", position = "stack") +
  labs(title = "Expenditure by Category and Year", x = "Year", y = "Expenditure") +
  theme_minimal()

# Aggregate expenditure by expense_category and get top 5 categories
top_categories <- all_data %>%
  group_by(expense_category) %>%
  summarise(total_expenditure = sum(expenditure, na.rm = TRUE)) %>%
  arrange(desc(total_expenditure)) %>%
  head(5)
```

```{r}
#| label: increasing-share-proof
#| fig-cap: Increasing Share of Total Expenditure
#| echo: false
# Filter data for EY and Deloitte
filtered_consultants <- all_data %>%
  filter(consultants_name %in% c("Ernst & Young LLP", "Ernst & Young", "Deloitte LLP", "Deloitte"))

# Calculate total expenditure per year
total_expenditure_per_year <- all_data %>%
  group_by(year) %>%
  summarise(total_expenditure = sum(expenditure, na.rm = TRUE))

# Calculate EY and Deloitte's share of expenditure per year
consultant_share <- filtered_consultants %>%
  group_by(year, consultants_name) %>%
  summarise(consultant_expenditure = sum(expenditure, na.rm = TRUE)) %>%
  left_join(total_expenditure_per_year, by = "year") %>%
  mutate(share_percentage = consultant_expenditure / total_expenditure * 100)

# Plot for EY's share over time
ey_plot <- ggplot(consultant_share %>% filter(consultants_name %in% c("Ernst & Young LLP", "Ernst & Young")),
                  aes(x = year, y = share_percentage)) +
  geom_line(color = "blue", size = 1) +
  geom_point(color = "blue", size = 2) +
  labs(title = "EY's Share of Total Expenditure Over Time",
       x = "Year", y = "Share of Expenditure (%)") +
  theme_minimal()

# Plot for Deloitte's share over time
deloitte_plot <- ggplot(consultant_share %>% filter(consultants_name %in% c("Deloitte LLP", "Deloitte")),
                        aes(x = year, y = share_percentage)) +
  geom_line(color = "green", size = 1) +
  geom_point(color = "green", size = 2) +
  labs(title = "Deloitte's Share of Total Expenditure Over Time",
       x = "Year", y = "Share of Expenditure (%)") +
  theme_minimal()

# Print the two plots
print(ey_plot)
print(deloitte_plot)
```

# Results{sec-results}


# Discussion{sec-discussion}

## Weaknesses and next steps{sec-future-work}

Weaknesses and next steps should also be included.

\newpage

\appendix

# Appendix {-}


# Additional data details



\newpage


# References


